include::_attributes.adoc[]


= Configuring ACS for Image Signature Verification

== Creating the Cosign Secret

. On your ssh terminal, run the following command to create a secret called signing-secrets in the openshift-pipelines namespace which Chains will use to sign your images:
+
[source, role="execute"]
----
COSIGN_PASSWORD=openshift cosign generate-key-pair k8s://openshift-pipelines/signing-secrets
----
. Along with generating a secret, the above command also creates a *cosign.pub* file in our home diretory.  This key is used for image signature verification.  Print the public key:
+
[source, role="execute"]
----
cat cosign.pub
----
Take note of the key as you will need it to copy it later to configure a Signature Integration in RHACS.

== Configure ACS Policy

. Go to the %rhacs_console_url%/[RHACS
console] and log in with your credentials username: *%rhacs_admin_user_name%* and password: *%rhacs_admin_password%*.
image:rhacs-login.png[]
+
. On the left menu, select *Platform Configuration > Integrations*
+
image:rhacs_integrations.png[]
. On the *Integrations* screen, select *Signature Integrations*
+
image::rhacs-signature-integration.png[]
. On the *Signature Integrations*, click the button *New integration*
.. For *Integration name* enter *cosign*
.. Expand the *Cosign* field and select *Add new public key*
.. For *Public key name* enter *cosign.pub*
.. For *Public key value* copy the public key from the terminal and paste it in this field.  This is used by RHACS to verify your image signatures.
.. Click save
+
image::rhacs-signature-integration-entry.png[]
+
. For convenience, we have already set up a policy in ACS called *0-Trusted Signature Policy* that checks an image for a valid signature.  This policy is enforced during the below lifecycle stages:
.. Build  - Runs when doing a roxctl image check on an image.  This will trigger a violation if the image passed to the command is not signed with our signature.
.. Deployment - Will prevent deployments to Openshift if images are not signed with our signature
+
This policy is currently disabled.
+
. On the left menu, select *Platform Configuration > Policy Management*
+
image::rhacs-policy-management.png[]
+
. The policy you are looking for is called *0-Trusted Signature Policy*.  It should be at the top of the list.
+
image::rhacs-policy-management-list.png[]
. Click the ellipse at the end and select *Edit policy*.
+
image::rhacs-policy-actions-popup.png[]
+
. Select *Policy criteria* and then click the *Select* button.
+
image::rhacs-policy-criteria-select.png[]
+
. Select the cosign signature integration and click save.
+
image::rhacs-policy-criteria-trusted-image-signers.png[]
+
. Continue clicking next at the bottom until you finally save the policy.
. Now that the policy is updated, we want to enable it.  Click the ellipse again for the same policy and select *Enable policy*
+
image::rhacs-policy-actions-popup.png[]